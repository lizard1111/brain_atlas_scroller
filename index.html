<!DOCTYPE html>
<html>
<head>
    <title>Brain Viewer</title>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: black;
            overflow: hidden;
        }

        .svg-container {
            position: absolute;
            top: 80px;
            right: 20px;
            bottom: 20px;
            left: 20px;
            overflow-x: hidden;
            overflow-y: hidden;
            display: flex;
            align-items: flex-start;
            scroll-snap-type: x mandatory mandatory;
        }

        .svg-item {
            flex-shrink: 0;
            width: 100%;
            height: 100%;
            scroll-snap-align: start;
            position: relative;
            transition: transform 0.s ease-in-out;
        }

        .slice-number {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 40px;
            pointer-events: none; /* Ensures the text does not interfere with scrolling */
        }

        .slider-container {
            position: absolute;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            color: rgb(215, 72, 72); /* Set the text color to black */
            padding: 5px;
            border-radius: 5px;
        font-size: 14px;
        pointer-events: none;
    }

        .slider {
            width: 100px;
        }

        .stroke {
            stroke-dasharray: 2, 2; /* Change the values as needed */
            stroke-width: 0.25; /* Adjust stroke width */
            stroke: white;
            fill: transparent;
        }

        /* Added path hover style */
        path:hover {
            fill: white; /* Highlight color when hovering */
        }
    </style>
    
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const svgContainer = document.querySelector('#svgContainer');
            const svgPath = 'svg2_viewbox/'; // Update with the relative path to your SVG folder
            const numSVGs = 528; // Number of SVGs to load
            let autoScrollSpeed = 60; // Speed in milliseconds (lower value = faster scrolling)
            let autoScrollInterval;
            let isPlaying = true;
            let isFillVisible = true;
            let skewAmount = 0;

            for (let i = 0; i < numSVGs; i++) {
                const svgElement = document.createElement('div');
                svgElement.classList.add('svg-item');
                svgElement.style.transform = `skewY(${skewAmount}deg)`; // Initialize skew

                fetch(`${svgPath}P56_Annotation_${i.toString().padStart(4, '0')}.svg`)
                    .then(response => response.text())
                    .then(data => {
                        svgElement.innerHTML = data;
                        const sliceNumberElement = document.createElement('div');
                        sliceNumberElement.classList.add('slice-number');
                        sliceNumberElement.textContent = `Slice #${i + 1}`;
                        svgElement.appendChild(sliceNumberElement);

                        // Store the original fill color and add a title for each path
                        const paths = Array.from(svgElement.getElementsByTagName('path'));
                        paths.forEach(path => {
                            path.dataset.originalFill = path.getAttribute('fill');

                            // Add a title element with the path data
                            const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                            title.textContent = path.getAttribute('d');
                            path.appendChild(title);

                            // Add mouseover and mouseout event listeners to handle hover styles
                            path.addEventListener('mouseover', handlePathMouseOver);
                            path.addEventListener('mouseout', handlePathMouseOut);
                        });
                    });

                svgContainer.appendChild(svgElement);
            }

            const svgItems = Array.from(svgContainer.querySelectorAll('.svg-item'));
            let currentIndex = 0;

            function showCurrentSVG() {
                svgItems[currentIndex].style.display = 'block';
            }

            function hideCurrentSVG() {
                svgItems[currentIndex].style.display = 'none';
            }

            function showNextSVG() {
                hideCurrentSVG();
                currentIndex = (currentIndex + 1) % numSVGs;
                showCurrentSVG();
            }

            function showPreviousSVG() {
                hideCurrentSVG();
                currentIndex = (currentIndex - 1 + numSVGs) % numSVGs;
                showCurrentSVG();
            }

            function startAutoScroll() {
                autoScrollInterval = setInterval(() => {
                    if (isPlaying) {
                        showNextSVG();
                    }
                }, autoScrollSpeed);
            }

            function pauseAutoScroll() {
                clearInterval(autoScrollInterval);
            }

            showCurrentSVG();
            startAutoScroll();

            function handleScroll(event) {
                event.preventDefault();
                const delta = Math.sign(event.deltaY);
                if (delta > 0) {
                    showNextSVG();
                } else if (delta < 0) {
                    currentIndex = (currentIndex - 1 + numSVGs) % numSVGs;
                    showCurrentSVG();
                }
            }

            svgContainer.addEventListener('wheel', handleScroll);

            // Slider functionality
            const sliderContainer = document.querySelector('.slider-container');
            const slider = document.querySelector('.slider');

            slider.addEventListener('input', function() {
                const sliderValue = this.value;
                autoScrollSpeed = 60 - (2 * sliderValue); // Adjust the formula as needed to increase speed
                clearInterval(autoScrollInterval);
                startAutoScroll();
            });

            function togglePlayPause() {
                isPlaying = !isPlaying;
                if (isPlaying) {
                    startAutoScroll();
                } else {
                    pauseAutoScroll();
                }
            }

            // Path mouseover event handler
            function handlePathMouseOver(event) {
                const path = event.target;
                path.style.fill = 'black'; // Apply hover color

                // Get the title element to extract data
                const titleElement = path.querySelector('title');
                if (titleElement) {
                    const pathData = titleElement.textContent;
                    const [acronym, name] = extractDataFromPath(pathData);
                    showTooltip(path, acronym, name);
                }
            }

            // Path mouseout event handler
            function handlePathMouseOut(event) {
                const path = event.target;
                path.style.fill = path.dataset.originalFill; // Restore original fill color
                hideTooltip();
            }

            // Function to extract acronym and name from path data
            function extractDataFromPath(pathData) {
                // Implement your logic to extract data from the path data here
                const acronym = "ABC"; // Replace with the actual acronym extracted
                const name = "Sample Name"; // Replace with the actual name extracted
                return [acronym, name];
            }

            // Function to show tooltip
            function showTooltip(path, acronym, name) {
                const tooltip = document.createElement('div');
                tooltip.classList.add('tooltip');
                tooltip.textContent = `Acronym: ${acronym}, Name: ${name}`;
                document.body.appendChild(tooltip);

                const pathBounds = path.getBoundingClientRect();
                const tooltipBounds = tooltip.getBoundingClientRect();

                // Position the tooltip just above the path element
                const top = pathBounds.top - tooltipBounds.height - 5;
                const left = pathBounds.left + (pathBounds.width - tooltipBounds.width) / 2;

                tooltip.style.top = `${top}px`;
                tooltip.style.left = `${left}px`;
            }

            // Function to hide tooltip
            function hideTooltip() {
                const tooltip = document.querySelector('.tooltip');
                if (tooltip) {
                    tooltip.remove();
                }
            }

            // Skew functionality
            function adjustSkew(event) {

            }

            function handleKeyPress(event) {
                const svgItems = Array.from(svgContainer.getElementsByTagName('svg'));
                switch (event.code) {
                    case 'Space':
                        event.preventDefault();
                        togglePlayPause();
                        break;
                    case 'ArrowRight': 
                        event.preventDefault();
                        if (isPlaying) togglePlayPause();
                        showNextSVG();
                        break;
                    case 'ArrowLeft':
                        event.preventDefault();
                        if (isPlaying) togglePlayPause();
                        showPreviousSVG();
                        break;
                    case 'KeyJ': // Adjust skew to the left
                        event.preventDefault();
                        skewAmount = Math.max(skewAmount - 0.5, -10);
                        svgItems.forEach(svg => {
                            svg.style.transform = `skewY(${skewAmount}deg)`;
                        });
                        break;
                    case 'KeyK': // Adjust skew to the right
                        event.preventDefault();
                        skewAmount = Math.min(skewAmount + 0.5, 10);
                        svgItems.forEach(svg => {
                            svg.style.transform = `skewY(${skewAmount}deg)`;
                        });
                        break;
                    case 'Digit1':
                        svgItems.forEach(svg => {
                            const paths = Array.from(svg.getElementsByTagName('path'));
                            paths.forEach(path => {
                                path.style.fill = path.dataset.originalFill;
                                path.style.stroke = 'none';
                            });
                        });
                        break;
                    case 'Digit2':
                        svgItems.forEach(svg => {
                            const paths = Array.from(svg.getElementsByTagName('path'));
                            paths.forEach(path => {
                                path.style.fill = 'black';
                                path.style.stroke = 'white';
                                path.classList.add('stroke');
                            });
                        });
                        break;
                    case 'Digit3':
                        svgItems.forEach(svg => {
                            const paths = Array.from(svg.getElementsByTagName('path'));
                            paths.forEach(path => {
                                path.style.fill = 'white';
                                path.style.stroke = 'black';
                                path.classList.add('stroke');
                            });
                        });
                        break;
                    case 'Digit4':
                        svgItems.forEach(svg => {
                            const paths = Array.from(svg.getElementsByTagName('path'));
                            paths.forEach(path => {
                                path.style.fill = 'black';
                                path.style.stroke = path.dataset.originalFill;
                                path.classList.add('stroke');
                            });
                        });
                        break;
                    default:
                        break;
                }
            }

            document.addEventListener('keydown', handleKeyPress);
        });
    </script>
</head>
<body>
    <div class="svg-container" id="svgContainer"></div>
    <div class="slider-container">
        <input type="range" min="0" max="30" value="0" step="1" class="slider">
    </div>
</body>
</html>
